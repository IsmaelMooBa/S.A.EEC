{% extends "base_admin.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="display-5 fw-bold text-primary mb-3">
        <i class="bi bi-eye me-3"></i>Ver Lista de Asistencia
    </h1>
    <a href="{{ url_for('pase_lista') }}" class="btn btn-secondary">‚Üê Volver a Listas</a>
</div>

<!-- Informaci√≥n de la Lista -->
<div class="card mb-4">
    <div class="card-header bg-info text-white">
        <h5 class="mb-0">üìã Informaci√≥n de la Lista</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-3">
                <strong>Fecha:</strong> {{ lista.fecha.strftime('%d/%m/%Y') }}
            </div>
            <div class="col-md-2">
                <strong>Mes:</strong> {{ lista.mes }}
            </div>
            <div class="col-md-2">
                <strong>Hora:</strong> {{ lista.hora }}
            </div>
            <div class="col-md-3">
                <strong>Materia:</strong> {{ lista.materia }}
            </div>
            <div class="col-md-2">
                <strong>Profesor:</strong> {{ lista.profesor }}
            </div>
        </div>
        <div class="row mt-2">
            <div class="col-12">
                <strong>Grupo:</strong> {{ lista.grupo_nombre }} - {{ lista.grado }} ({{ lista.turno }})
            </div>
        </div>
    </div>
</div>

<!-- Lista de Asistencia -->
<div class="card">
    <div class="card-header bg-success text-white">
        <h5 class="mb-0">üéØ Asistencia y Calificaciones</h5>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-0">
                <thead class="table-dark">
                    <tr>
                        <th width="100">Matr√≠cula</th>
                        <th>Nombre del Alumno</th>
                        <th width="100">Asistencia</th>
                        <th width="120">Calificaci√≥n</th>
                        <th width="120">Estado Validaci√≥n</th>
                        <th width="100">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for alumno in alumnos %}
                    <tr>
                        <td>
                            <strong>{{ alumno.codigo_matricula or 'Sin matr√≠cula' }}</strong>
                        </td>
                        <td>
                            {{ alumno.nombre }} {{ alumno.apellido }}
                        </td>
                        <td>
                            {% if alumno.asistio %}
                                <span class="badge bg-success">‚úÖ Asisti√≥</span>
                            {% else %}
                                <span class="badge bg-danger">‚ùå No asisti√≥</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if alumno.calificacion %}
                                <span class="badge bg-info">{{ alumno.calificacion }}%</span>
                            {% else %}
                                <span class="badge bg-secondary">Sin calificaci√≥n</span>
                            {% endif %}
                        </td>
                        <td class="text-center">
                            {% if alumno.validado %}
                                <span class="badge bg-success">
                                    <i class="bi bi-check-circle me-1"></i>Validado
                                </span>
                                <br>
                                <small class="text-muted">Por el estudiante</small>
                            {% else %}
                                <span class="badge bg-warning">
                                    <i class="bi bi-clock me-1"></i>Pendiente
                                </span>
                            {% endif %}
                        </td>
                        <td>
                            {% if alumno.codigo_matricula %}
                            <button type="button" class="btn btn-sm btn-outline-info" 
                                    data-bs-toggle="tooltip" data-bs-title="Ver detalles del estudiante"
                                    onclick="verDetalleEstudiante('{{ alumno.codigo_matricula }}')">
                                <i class="bi bi-person"></i>
                            </button>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <div class="card-footer bg-light">
        <div class="row text-center">
            <div class="col-md-2">
                <strong>Total Alumnos:</strong> 
                <span class="badge bg-primary">{{ total_alumnos }}</span>
            </div>
            <div class="col-md-2">
                <strong>Asistieron:</strong> 
                <span class="badge bg-success">{{ total_asistencia }}</span>
            </div>
            <div class="col-md-2">
                <strong>Faltaron:</strong> 
                <span class="badge bg-danger">{{ total_alumnos - total_asistencia }}</span>
            </div>
            <div class="col-md-3">
                <strong>Validados:</strong> 
                <span class="badge {% if total_validados == total_alumnos %}bg-success{% else %}bg-warning{% endif %}">
                    {{ total_validados }}/{{ total_alumnos }}
                </span>
            </div>
            <div class="col-md-3">
                <strong>Porcentaje Validaci√≥n:</strong> 
                <span class="badge {% if (total_validados / total_alumnos * 100) >= 80 %}bg-success{% elif (total_validados / total_alumnos * 100) >= 50 %}bg-warning{% else %}bg-danger{% endif %}">
                    {{ "%.1f"|format((total_validados / total_alumnos * 100) if total_alumnos > 0 else 0) }}%
                </span>
            </div>
        </div>
        
        <!-- Barra de progreso de validaci√≥n -->
        <div class="mt-3">
            <div class="d-flex justify-content-between mb-1">
                <small>Progreso de Validaci√≥n</small>
                <small>{{ total_validados }}/{{ total_alumnos }} estudiantes</small>
            </div>
            <div class="progress" style="height: 8px;">
                <div class="progress-bar {% if (total_validados / total_alumnos * 100) >= 80 %}bg-success{% elif (total_validados / total_alumnos * 100) >= 50 %}bg-warning{% else %}bg-danger{% endif %}" 
                     role="progressbar" 
                     style="width: {{ (total_validados / total_alumnos * 100) if total_alumnos > 0 else 0 }}%"
                     aria-valuenow="{{ total_validados }}" 
                     aria-valuemin="0" 
                     aria-valuemax="{{ total_alumnos }}">
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Resumen de Validaci√≥n -->
<div class="card mt-4">
    <div class="card-header bg-warning text-dark">
        <h5 class="mb-0">üìä Resumen de Validaci√≥n</h5>
    </div>
    <div class="card-body">
        <div class="row text-center">
            <div class="col-md-4">
                <div class="border rounded p-3 bg-success bg-opacity-10">
                    <h3 class="text-success">{{ total_validados }}</h3>
                    <small class="text-muted">Validados</small>
                </div>
            </div>
            <div class="col-md-4">
                <div class="border rounded p-3 bg-warning bg-opacity-10">
                    <h3 class="text-warning">{{ total_alumnos - total_validados }}</h3>
                    <small class="text-muted">Pendientes</small>
                </div>
            </div>
            <div class="col-md-4">
                <div class="border rounded p-3 {% if total_validados == total_alumnos %}bg-success bg-opacity-10{% else %}bg-secondary bg-opacity-10{% endif %}">
                    <h3 class="{% if total_validados == total_alumnos %}text-success{% else %}text-secondary{% endif %}">
                        {{ "%.1f"|format((total_validados / total_alumnos * 100) if total_alumnos > 0 else 0) }}%
                    </h3>
                    <small class="text-muted">Completado</small>
                </div>
            </div>
        </div>
        
        {% if total_validados < total_alumnos %}
        <div class="alert alert-info mt-3">
            <i class="bi bi-info-circle me-2"></i>
            <strong>Informaci√≥n:</strong> {{ total_alumnos - total_validados }} estudiantes a√∫n no han validado su asistencia. 
            Los estudiantes pueden validar desde su panel de control.
        </div>
        {% else %}
        <div class="alert alert-success mt-3">
            <i class="bi bi-check-circle me-2"></i>
            <strong>¬°Excelente!</strong> Todos los estudiantes han validado su asistencia.
        </div>
        {% endif %}
    </div>
</div>

<script>
function verDetalleEstudiante(matricula) {
    // Aqu√≠ puedes implementar la funcionalidad para ver detalles del estudiante
    alert('Detalles del estudiante con matr√≠cula: ' + matricula);
    // En una implementaci√≥n real, esto podr√≠a abrir un modal o redirigir a otra p√°gina
}

// Inicializar tooltips
document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});
</script>

<style>
.table th {
    background-color: #2c3e50;
    color: white;
    border-bottom: 2px solid #34495e;
}

.card-footer {
    background-color: #f8f9fa;
    border-top: 1px solid #dee2e6;
}

.badge {
    font-size: 0.75rem;
}

.progress {
    border-radius: 10px;
}

.progress-bar {
    border-radius: 10px;
    transition: width 0.3s ease;
}

.alert {
    border-radius: 10px;
}
</style>
{% endblock %}